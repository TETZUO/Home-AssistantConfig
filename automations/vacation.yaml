- id: turn_on_den_when_sun_sets
  alias: Turn on den light when sun sets
  trigger:
    platform: sun
    event: sunset
    offset: "-00:60:00"
  condition:
    condition: state
    entity_id: input_boolean.vacation_mode
    state: 'on'
  action:
    - service: light.turn_on
      data:
        entity_id: light.den_2
        brightness: 75
        rgb_color: [ 255,207,120 ]

- id: change_den_color_to_red_when_norbert_off
  alias: Change den light color to red when Norbert goes off
  trigger:
    platform: time
    at: '20:35:00'
  condition:
    condition: state
    entity_id: input_boolean.vacation_mode
    state: 'on'
  action:
    - service: light.turn_on
      data:
        entity_id: light.den_2
        brightness: 100
        rgb_color: [ 255,0,0 ]

- id: turn_off_den_and_at_random_time
  alias: Turn den off and master on at a semi-random time
  trigger:
    - platform: template
      value_template: "{{ is_state('sensor.time', states('input_number.random_hour')|int ~ ':' ~ states('input_number.random_minute')|int) }}"
  condition:
    condition: state
    entity_id: input_boolean.vacation_mode
    state: 'on'
  action:
    - service: light.turn_off
      data:
        entity_id: light.den_2
    - service: light.turn_on
      data:
        entity_id: light.master_1
        brightness: 50
        rgb_color: [ 255,255,255 ]
    - service: light.turn_on
      data:
        entity_id: light.master_2
        brightness: 50
        rgb_color: [ 255,255,255 ]
    - service: homeassistant.turn_on
      entity_id: script.timed_lamp

- id: turn_on_light_for_overnight
  alias: Turn on lights for overnight
  trigger:
    platform: time
    at: '22:30:00'
  condition:
    condition: state
    entity_id: input_boolean.vacation_mode
    state: 'on'
  action:
    service: switch.turn_on
    entity_id: switch.front_outside_lights_140

- id: turn_off_lights_in_the_early_morning
  alias: Turn off lights in the early morning
  trigger:
    platform: time
    at: '06:00:00'
  condition:
    condition: state
    entity_id: input_boolean.vacation_mode
    state: 'on'
  action:
    service: switch.turn_off
    entity_id: switch.front_outside_lights_140

- id: set_random_time
  alias: set_random_time
  trigger:
    - platform: time
      at: '21:00:00'
  action:
    - service: input_number.select_value
      data_template:
        entity_id: input_number.random_hour
        # The endpoint is omitted, see: http://jinja.pocoo.org/docs/dev/templates/#range
        value: '{{ (range(22, 24)|random) }}'
    - service: input_number.select_value
      data_template:
        entity_id: input_number.random_minute
        value: '{{ (range(15, 46)|random) }}'